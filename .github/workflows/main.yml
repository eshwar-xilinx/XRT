name: Test Action

on:     
  pull_request:

jobs:
  main:
    runs-on: pr_pipeline
    steps:
    - name: Creating environmental variables
      run: |
         echo "$GITHUB_REF"
         DIR_PATH=$(readlink -f .)
         PR_NUMBER=$(echo $GITHUB_REF | awk 'BEGIN { FS = "/" } ; { print $3 }')
         echo "$PR_NUMBER generated by GITHUB_REF env"
         echo "${{github.event.pull_request.number}} generated by github action event"
         
    - name: Changing working directory
      run: |
          cd 
          
    - name: Removing pre-existed XRT folder if present
      run: |
          rm -rf XRT
          
    - name: Cloning XRT
      run: |
         git clone "https://github.com/eshwar-xilinx/XRT.git"
         
    - name: Changing directory 
      run: |
         cd XRT
         
    - name: Fetching to PR branch
      run: |
         git fetch origin pull/${{github.event.pull_request.number}}/head:master1
     
    - name: Checkout PR branch
      run: |
         git checkout master1
         
    - name: Running XRT deps for dependencies
      run: |
          sudo ./src/runtime_src/tools/scripts/xrtdeps.sh
          
    - name: Building deb/rpm
      run: |
          sudo ./build/build.sh
